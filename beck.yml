---
  - name: QueueImages-Store13-Screen1-Morning
    hosts: all
    gather_facts: false

    tasks:
      - name: test vars
        debug:
          msg: "{{ test_var }}"

      - name: setup
        setup:
          filter: ansible_date_time

      - name: register json as variable
        shell: cat /home/cpcc/StoreDisplayClient/data.json
        register: result

      - name: set jsondata fact
        set_fact:
          jsondata: "{{ result.stdout | from_json }}"

      - name: set images fact
        set_fact:
          images: "{{ jsondata | json_query(jmesquery) }}"
        vars:
          jmesquery: "Stores[?Name=='Store 13'].Screens[] | [?Name=='Screen 1'].Schedules[] | [?Date=='{{ ansible_date_time.date }}'].MorningRotation[].Images[].[Name, Path]"

      - name: copy images
        copy: 
          src: /home/cpcc/StoreDisplayClient/ImageCache/{{ item[1] }}/{{ item[0] }}
          remote_src: true
          dest: /home/cpcc/Sync/Store13/Screen1/
        with_items:
          - "{{ images }}"
...       
